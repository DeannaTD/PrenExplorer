<section class="project-container">
    <div class="project-container__logo">
        <img src="" alt="Logo" srcset="">
    </div>
    
    <p class="project-name">Урок 29. Обучение Python GUI (PyQt и Qt Designer)</p>
    <div class="description-block">
	    <article class="description-block__text">
                  <p>Для начала создайте новый проект в pycharm.</p>
                  <p>Установим PyQt:</p>
                  <p>Шаг 1.  File -> Settings -> Project: имя проекта -> Project Interpreter</p>
                  <p>Шаг 2. Выбираете нужный интерпретатор Python.</p>
                  <p>Шаг 3. Нажимаем на плюсик, чтобы добавить новый пакет</p>
                  <p>Шаг 4. Находим пакет “PyQt5”.</p>
                  <p>Шаг 5. Нажимаем Install Package</p>
                  <p>И так же устанавливаем пакет pyQt5-tools </p>
                  <p>Далее настроим PyCharm для работы с библиотекой PyQt5.</p>
                  <p>Первым делом подключим Designer, чтобы можно было более удобно создавать ui-файлы.</p>
                  <p>Шаг 1. Переходим в меню «File» → «Settings» → «Tools» → «External tools»</p>
                  <p>Шаг 2. Нажимаем на плюсик, чтобы создать новый инструмент.</p>
                  <p>Шаг 3. Вписываем следующие данные и нажимаем ок.</p>
                  <p>В пункте Program находим файл designer.exe. Он находится по следующему пути:</p>
                  <p>Название проекта \venv\Lib\site-packages\qt5_applications\Qt\bin\designer.exe</p>
                  <img class="project_image" src="../projects/python_image/project29_1.png">
                  <p>Теперь добавим новый тип файла (для ui).</p>
                  <p>Шаг 1. «File» → «Settings» → «Editor» → «File and code Templates»</p>
                  <p>Шаг 2. Нажимаем на плюсик, чтобы добавить описание нового шаблона</p>
                  <p>Шаг 3. Заполняем все поля согласно образцу</p>
                  <img class="project_image" src="../projects/python_image/project29_2.png">
                  <p>Вот код для вставки в поле</p>
                  <pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ui version="4.0"&gt;
 &lt;class&gt;MainWindow&lt;/class&gt;
 &lt;widget class="QMainWindow" name="MainWindow"&gt;
  &lt;property name="geometry"&gt;
   &lt;rect&gt;
    &lt;x&gt;0&lt;/x&gt;
    &lt;y&gt;0&lt;/y&gt;
    &lt;width&gt;429&lt;/widt&gt;
    &lt;height&gt;386&lt;/height&gt;
   &lt;/rect&gt;
  &lt;/property&gt;
  &lt;property name="windowTitle"&gt;
   &lt;string&gt;MainWindow&lt;/string&gt;
  &lt;/property&gt;
  &lt;widget class="QWidget" name="centralwidget"&gt;
  &lt;/widget&gt;
 &lt;/widget&gt;
 &lt;resources/  &gt;                 
 &lt;connections/&gt;
&lt;/ui&gt;
</pre>  
                  <p>Шаг 4. Нажимаем «OK».</p>
                  <p>Теперь у нас появилась возможность не только создавать файлы форм, но и запускать Qt Designer не выходя из PyCharm. Делается это следующим образом:</p>
                  <p>Создаем файл в формате ui.</p>
                  <p>Наводим курсор на UI-файл → Правая кнопка мыши → «External tools» → «Qt Designer»</p>
                  <p>Если дизайнер не запускается, и выдает ошибку, то нужно сделать следующее:</p>
                  <p>Заходим в папку нашего проекта:</p>
                  <p>Название проекта →  venv → Lib → site-packages → PyQt5 → Qt → plugins</p>
                  <p>В папке plugins копируем папку platforms </p>
                  <p>После этого переходим в папку qt5_applications → Qt → bin,</p>
                  <p>И вставляем туда папку platforms</p>
                  <p>После этого должно все работать.</p>
                  <p>После открытия файла в дизайнере вы увидите, что новая форма уже создана.</p>
                  <p><b>Форма</b> — шаблон для окна, размер которого можно менять и куда можно вставлять объекты из окна виджетов и т.д.</p>
                  <p>Все элементы формы и их иерархия по умолчанию отображаются в правой части окна Qt Designer под названием Object Inspector. Вы с лёгкостью можете удалять объекты, кликая по ним правой кнопкой мыши в этом окне. Или же вы можете выбрать их в основной форме и нажать клавишу DEL на клавиатуре.</p>
                  <p>Ознакомьтесь с интерфейсом, он довольно простой.</p>
                  <p>Теперь дайте попробуем создать нашу первую форму:</p>
                  <p>Перетащите куда-нибудь в основную форму List Widget и Push Button из Widget Box.</p>
                  <p><b>Макеты</b></p>
                  <p>Вместо использования фиксированных позиций и размеров элементов в приложении лучше использовать макеты. Фиксированные позиции и размеры у вас будут выглядеть хорошо (пока вы не измените размер окна), но вы никогда не можете быть уверены, что всё будет точно так же на других машинах и/или операционных системах.</p>
                  <p>Макеты представляют собой контейнеры для виджетов, которые будут удерживать их на определённой позиции относительно других элементов. Поэтому при изменении размера окна размер виджетов тоже будет меняться.</p>
                  <p>Перетащите список и кнопку в форме и измените их размер, чтобы вышло вот так:</p>
                  <img class="project_image" src="../projects/python_image/project29_3.png">
                  <p>Основное окно уже поддерживает макеты, поэтому нам ничего не нужно добавлять в нашу форму. Просто кликните правой кнопкой мыши по Main Window в Object Inspector и выберите Lay out → Lay out vertically. Также вы можете кликнуть правой кнопкой по пустой области в форме и выбрать те же опции:</p>
                  <img class="project_image" src="../projects/python_image/project29_4.png">
                  <p>Ваши элементы должны быть в том же порядке, что и до внесённых изменений, но если это не так, то просто перетащите их на нужное место.</p>
                  <p>Так как мы использовали вертикальное размещение, все элементы, которые мы добавим, будут располагаться вертикально. Можно комбинировать размещения для получения желаемого результата. Например, горизонтальное размещение двух кнопок в вертикальном будет выглядеть так:</p>
                  <img class="project_image" src="../projects/python_image/project29_5.png">
                  <p>Если у вас не получается переместить элемент в главном окне, вы можете сделать это в окне Object Inspector.</p>
                  <p><b>Последние штрихи</b></p>
                  <p>Теперь, благодаря вертикальному размещению, наши элементы выровнены правильно. Единственное, что осталось сделать (но не обязательно), — изменить имя элементов и их текст.</p>
                  <p>В простом приложении вроде этого с одним лишь списком и кнопкой изменение имён не обязательно, так как им в любом случае просто пользоваться. Тем не менее правильное именование элементов — то, к чему стоит привыкать с самого начала.</p>
                  <p>Свойства элементов можно изменить в разделе Property Editor.</p>
                  <p>Нажмите на кнопку, которую вы добавили в форму. Теперь в Property Editor вы должны видеть все свойства этого элемента. В данный момент нас интересуют objectName и text в разделе QAbstractButton. Вы можете сворачивать разделы в Property Editor нажатием по названию раздела.</p>
                  <p>Измените значение objectName на btnBrowse и text на Выберите папку.</p>
                  <p>Должно получиться так:</p>
                  <img class="project_image" src="../projects/python_image/project29_6.png">
                  <p>Именем объекта списка является listWidget, что вполне подходит в данном случае.</p>
                  <p>Закрываем дизайнер и он спрашивает сохранить ли изменения в файле. Нажимаем save.</p>
                  <p><b>Превращаем дизайн в код</b></p>
                  <p>Конечно, можно использовать .ui-файлы напрямую из Python-кода, однако есть и другой путь, который может показаться легче. Можно конвертировать код .ui-файла в Python-файл, который мы потом сможем импортировать и использовать. Для этого мы используем команду pyuic5 из терминала/командной строки.</p>
                  <p>Чтобы конвертировать .ui-файл в Python-файл с названием design.py, в терминале используйте следующую команду:</p>
                  <p>$ pyuic5 design.ui -o design.py</p>
                  <p><b>Пишем код</b></p>
                  <p>Теперь у нас есть файл design.py с нужной частью дизайна нашего приложения и мы начинать работу над созданием его логики.</p>
                  <p>Создайте файл main.py</p>
                  <p><b>Используем дизайн</b></p>
                  <p>Для Python GUI приложения понадобятся следующие модули:</p>
                  <p>import sys  # sys нужен для передачи argv в QApplication</p>
                  <p>from PyQt5 import QtWidgets</p>
                  <p>Также нам нужен код дизайна, который мы создали ранее, поэтому его мы тоже импортируем:</p>
                  <p>import design  # Это наш конвертированный файл дизайна</p>
                  <p>Так как файл с дизайном будет полностью перезаписываться каждый раз при изменении дизайна, мы не будем изменять его. Вместо этого мы создадим новый класс ExampleApp, который объединим с кодом дизайна для использования всех его функций:</p>
                  <p>class ExampleApp(QtWidgets.QMainWindow, design.Ui_MainWindow):</p>
                  <p> &emsp;&emsp;   def __init__(self):</p>
                  <p> &emsp;&emsp;&emsp;       # Это здесь нужно для доступа к переменным, методам</p>
                  <p>&emsp;&emsp;&emsp;        # и т.д. в файле design.py</p>
                  <p>&emsp;&emsp;&emsp;        super().__init__()</p>
                  <p> &emsp;&emsp;&emsp;       self.setupUi(self)  # Это нужно для инициализации нашего дизайна</p>
                  <p>В этом классе мы будем взаимодействовать с элементами интерфейса, добавлять соединения и всё остальное, что нам потребуется. Но для начала нам нужно инициализировать класс при запуске кода. С этим мы разберёмся в функции main():</p>
                  <p>def main():</p>
                  <p>&emsp;    app = QtWidgets.QApplication(sys.argv)  # Новый экземпляр QApplication</p>
                  <p>&emsp;    window = ExampleApp()  # Создаём объект класса ExampleApp</p>
                  <p>&emsp;    window.show()  # Показываем окно</p>
                  <p>&emsp;    app.exec_()  # и запускаем приложение</p>
                  <p>И чтобы выполнить эту функцию, мы воспользуемся привычной конструкцией:</p>
                  <p>if __name__ == '__main__':  # Если мы запускаем файл напрямую, а не импортируем</p>
                  <p>&emsp;    main()  # то запускаем функцию main()</p>
                  <p>Если запустить main.py то наше приложение запустится:</p>
                  <img class="project_image" src="../projects/python_image/project29_7.png">
                  <p>Но нажатие на кнопку ничего не даёт, поэтому нам придётся с этим разобраться.</p>
                  <p><b>Добавляем функциональность в наше Python GUI приложение</b></p>
                  <p>Весь дальнейший код пишется внутри класса ExampleApp.</p>
                  <p>Начнём с кнопки Выберите папку. Привязать к функции событие вроде нажатия на кнопку можно следующим образом:</p>
                  <p>self.btnBrowse.clicked.connect(self.browse_folder)</p>
                  <p>Добавьте эту строку в метод __init__ класса ExampleApp, чтобы выполнить привязку при запуске приложения. А теперь взглянем на неё поближе:</p>
                  <p>self.btnBrowse: здесь btnBrowse — имя объекта, который мы определили в Qt Designer. self говорит само за себя и означает принадлежность к текущему классу;</p>
                  <p>clicked — событие, которое мы хотим привязать. У разных элементов разные события, например, у виджетов списка есть itemSelectionChanged и т.д.;</p>
                  <p>connect() — метод, который привязывает событие к вызову переданной функции;</p>
                  <p>self.browse_folder — просто функция (метод), которую мы описали в классе ExampleApp.</p>
                  <p>Для открытия диалога выбора папки мы можем использовать встроенный метод QtWidgets.QFileDialog.getExistingDirectory:</p>
                  <p>directory = QtWidgets.QFileDialog.getExistingDirectory(self, "Выберите папку")</p>
                  <p>Если пользователь выберет директорию, переменной directory присвоится абсолютный путь к выбранной директории, в противном случае она будет равна None. Чтобы не выполнять код дальше, если пользователь закроет диалог, мы используем команду if directory:.</p>
                  <p>Для отображения содержимого директории нам нужно импортировать os:</p>
                  <p>import os</p>
                  <p>И получить список содержимого следующим образом:</p>
                  <p>os.listdir(path)</p>
                  <p>Для добавления элементов в listWidget мы используем метод addItem(), а для удаления всех элементов у нас есть self.listWidget.clear().</p>
                  <p>В итоге функция browse_folder должна выглядеть так:</p>
                  <p>def browse_folder(self):</p>
                  <p>&emsp;    self.listWidget.clear()  # На случай, если в списке уже есть элементы</p>
                  <p>&emsp;    directory = QtWidgets.QFileDialog.getExistingDirectory(self, "Выберите папку")</p>
                  <p>&emsp;    # открыть диалог выбора директории и установить значение переменной</p>
                  <p>&emsp;    # равной пути к выбранной директории</p>
                  <p></p>
                  <p>&emsp;    if directory:  # не продолжать выполнение, если пользователь не выбрал директорию</p>
                  <p>&emsp;&emsp;        for file_name in os.listdir(directory):  # для каждого файла в директории</p>
                  <p>&emsp;&emsp;&emsp;            self.listWidget.addItem(file_name)   # добавить файл в listWidget</p>
                  <p>Теперь, если запустить приложение, нажать на кнопку и выбрать директорию, мы увидим:</p>
                  <img class="project_image" src="../projects/python_image/project29_8.png">
                  <p>Это были основы использования Qt Designer и PyQt для разработки Python GUI приложения. Теперь вы можете спокойно изменять дизайн приложения и использовать команду pyuic5 без страха потерять написанный код.</p>
          </article>
        <div class="description-block__image">
            <img src="" alt="" srcset="">
        </div>
    </div>
</section>